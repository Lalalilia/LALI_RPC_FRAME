#### 1.基本介绍

*****************

本网络库的核心思想是 **Reactor** 事件驱动模型，采用**多线程 one loop per thread**（即每个线程都拥有一个 EventLoop），使用 **NON-Blocking IO+IO multiplexing** 作为IO模型，使用 **epoll** 实现，设置有**线程池**，可避免线程频繁创建与销毁的开销。详细见 **网络模型.md**

本项目含：

- 异步多线程的 RPC 框架。采用 json 格式的序列化 / 反序列化方案，程序自动生成 service/client stub 程序，用户 include 相应 stub 即可接收/发起 RPC ；（ JSON 脚本解析采用了 jackson 开源库）
- 基于 NON-Blocking IO + IO multiplexing（epoll 水平触发） 的 Reactor 事件驱动模型的网络服务器。使用多线程充分利用多核 CPU，并使用了线程池避免了频繁创建销毁线程的开销，主线程只 accept 请求，以 Round Robin 的方式分发给其它 IO 线程，采用 eventfd 实现线程异步唤醒
- 异步日志系统。使用双缓冲区及批处理方式
- 使用 timerfd 将定时器当作 IO 事件处理，并使用红黑树进行定时器的关闭超时请求

- 使用智能指针的 RAII 机制，减少了内存泄漏的可能
- 支持服务器的优雅关闭

- 客户端支持异步 RPC, 也可以通过线程同步达到同步 RPC 的效果.
- 服务端支持多线程 RPC, 即用户可以将 RPC 请求交给另一个线程 (或者线程池) 去执行，这样 IO 线程就可以立刻开始等待下一个请求.
- 通过![[公式]](https://www.zhihu.com/equation?tex=service.method) 唯一定义一个 procedure. 一个 TCP 端口可以对外提供多个 service, 一个 service 可以有多个 method.

#### 2.代码介绍

*******************

本项目基于 Ubuntu18.04 系统，依赖 pthread 线程库。

base 文件中为锁，线程，线程池，条件变量，时间等封装类便于使用，并且有日志库LOG的实现。

net 文件中包含核心事件驱动模型的类 EventLoop，Channel，Poller 类的实现，处理Tcp连接的 TcpServer，TcpConnecion，Acceptor 类的实现，处理Http请求的 Httpserver，HttpRequest，HttpRespond，HttpContext 类的实现。

test  文件中包含一些简单的小程序测试，后续会逐渐完善。

| 文件名                                                       | 简介                                                         |
| ------------------------------------------------------------ | :----------------------------------------------------------- |
| base/Mutex.h                                                 | 自行封装的一个锁类，能够将锁的lock和unlock用类的构造和析构函数自动执行，以免忘记将锁unlock； |
| base/thread.h&.cc                                            | 线程类，封装线程相关函数，用于线程创建，启动；               |
| base/Condition.h                                             | 条件变量封装，用于线程同步                                   |
| base/CountDownLatch.h&.cc                                    | 闭锁类，用于线程同步                                         |
| base/ThreadPool.h&.cc                                        | 线程池类                                                     |
| base/Timestamp.h&.cc                                         | 时间戳类，获取Unix时间，进行处理，转化成格式化string，并实现操作符重载支持时间戳的比较； |
| base/ThreadLocal.h                                           | 线程存储类，让一个线程独立拥有数据，不受其他线程影响，而线程安全。 |
| base/Singleton.h                                             | 用pthread_once 实现的单例模式。                              |
| base/Exception.g&.cc                                         | 异常类，继承 std::exception 类，用于错误提示（待完善）       |
| base/Logging.h&.cc<br />Logstream.h&.cc<br />LogFile.h&.cc<br />FileUtil.h&.cc | 实现日志LOG类，logging 为日志实现模块核心，负责接收信息并写入文件，Logstream 是自己实现的一个流类，不使用语言自带的 iostream；LogFile 是用于处理日志文件，并会自动滚动日志文件；FileUtil 将日志写入硬盘 |
| base/AsyncLogging.h&.cc                                      | 异步写日志，利用双缓冲，批处理机制高效将日志写入硬盘         |
| net/EventLoop.h&.cc                                          | 处理事件循环                                                 |
| net/Channel.h&.cc                                            | 通道类用于不同事件类型分发，调用相应的回调函数               |
| net/Poller.h&.cc                                             | 实现 IO 复用，检测活跃事件                                   |
| net/Buffer.h&.cc                                             | buffer 缓存类用于接收信息及发送信息                          |
| net/Socket.h&.cc                                             | 将 socket 套接字封装成类管理                                 |
| net/Tcpserver.h&.cc                                          | 管理 tcp 连接和断开                                          |
| net/Acceptor.h&.cc                                           |                                                              |
| net/Tcpconnectino.h&.cc                                      |                                                              |
| net/EventLoopThreadPool.h&.cc                                |                                                              |
| net/HttpServer.h&.cc                                         |                                                              |



#### 3.测试使用

************

在LALI文件下使用

```
 cmake. 
```

生成 Makefile  再使用 

```
make 
```

